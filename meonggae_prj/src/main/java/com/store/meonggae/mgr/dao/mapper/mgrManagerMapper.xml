<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.store.meonggae.mgr.manager">
	<resultMap type="usrGraphDomain" id="usrGraphDomResult">
		<result column="input_date" property="col"/>
		<result column="CNT" property="cnt"/>
	</resultMap>
	<resultMap type="mgrManagerDomain" id="mgrManagerDomResult">
		<result column="MANAGER_ID" property="managerId"/>
		<result column="DNAME" property="dname"/>
		<result column="PARENT_MANAGER_ID" property="parentManagerId"/>
		<result column="PARENT_MANAGER_NAME" property="parentManagerName"/>
		<result column="NAME" property="name"/>
		<result column="BIRTH" property="birth"/>
		<result column="NICK" property="nick"/>
		<result column="GENDER" property="gender"/>
		<result column="EMAIL" property="email"/>
		<result column="ADDR1" property="addr1"/>
		<result column="ADDR2" property="addr2"/>
		<result column="TEL" property="tel"/>
		<result column="PERMISSION" property="permission"/>
		<result column="INPUT_DATE" property="inputDate"/>
		<result column="DELETE_FLAG" property="deleteFlag"/>
		<result column="DELETE_DATE" property="deleteDate"/>
	</resultMap>
	
	<!-- 게시판 리스트의 수 -->
	<select id="selectOneListCnt" resultType="int" parameterType="sVO">
		select	count(*) cnt
		from	manager
		<choose>
			<when test="field eq 0">
				<where>
					manager_id like '%' || #{keyword} || '%'
				</where>
			</when>
			<when test="field eq 1">
				<where>
					nick like '%' || #{keyword} || '%'
				</where>
			</when>
		</choose> 
	</select>
	
	<!-- 게시판 리스트 목록 조회 -->
	<select id="selectListManager" resultMap="mgrManagerDomResult" parameterType="sVO">
		select	rnum, NAME, dname, MANAGER_ID, NICK, INPUT_DATE
		from	(
				select	row_number() over(order by m.nick) rnum, m.NAME, d.dname, m.MANAGER_ID, m.NICK, m.INPUT_DATE
				from	manager m, dept d
				where	m.deptno = d.deptno 
				<choose>
					<when test="field eq 0">
						and instr(manager_id, #{keyword}) > 0 
					</when>
					<when test="field eq 1">
						and instr(nick, #{keyword}) > 0 
					</when>
				</choose> 
				)
		where	rnum between #{startNum} and #{endNum}
	</select>
	
	<!-- 게시판 목록 하나 조회 -->
	<select id="selectOneManager" resultMap="mgrManagerDomResult" parameterType="String">
		select	m.NAME, m.birth, m.tel, m.gender, m.addr1, m.addr2,
				(select name from manager where manager_id = m.PARENT_MANAGER_ID) PARENT_MANAGER_NAME,
				m.manager_id, m.nick, m.permission, m.input_date
		from	manager m, dept d
		where	m.deptno = d.deptno and m.manager_id=#{managerId}
	</select>
</mapper>